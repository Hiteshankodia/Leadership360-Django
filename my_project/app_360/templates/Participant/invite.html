{% extends 'Base/surveybase.html' %}

{% block title %}Project360{% endblock %}

{% block content %}
<div class="main-content">
    <div class="container">
        <form id="saveForm" method="POST" action="{% url 'save_data' %}">
            {% csrf_token %}
            <div class="row">
                <div class="col-12"> 
                    <div class="table-container">
                        <table class="table table-bordered">
                            <thead class="table-secondary">
                                <tr>
                                    <th>Name</th>
                                    <th>Designation</th>
                                    <th>Department</th>
                                    <th>Location</th>
                                    <th>Email</th>
                                    <th>Date of Birth</th>
                                    <th>Country</th>
                                    <th>State</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in itereration %}
                                    {% include 'Participant/_invite_form.html' with index=i departments=departments countries=countries states=states %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <button type="submit" class="btn btn-custom">Save and Next</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Populate state dropdown based on selected country
        const statesData = {{ states|safe }};
        
        document.querySelectorAll('select[id^="intcountry_"]').forEach(countrySelect => {
            countrySelect.addEventListener('change', function() {
                const index = this.id.split('_')[1];
                const stateSelect = document.getElementById(`intstate_${index}`);
                const countryId = this.value;
                
                // Clear previous options
                stateSelect.innerHTML = '<option value="" disabled selected>Select a State</option>';
                
                // Populate new options
                const filteredStates = statesData.filter(state => state.countryid == countryId);
                filteredStates.forEach(state => {
                    const option = document.createElement('option');
                    option.value = state.id;
                    option.textContent = state.statename;
                    stateSelect.appendChild(option);
                });
            });
        });
    });
</script>
{% endblock %}
