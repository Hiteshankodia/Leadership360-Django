{% extends 'Base/surveybase.html' %}

{% block title %}Project360{% endblock %}

{% block content %}
<div class="content">
    <div class="content-wrapper">
        <div class="container text-center">
            <h4 class="instruction-text">
                For better results and assessment, 8 references will be ideal. However, participants are free to provide at least 6, including 1 Reporting Manager, 2 Peers, and 3 Subordinates.
            </h4>
        </div>
        <div class="container mt-4 form-container">

            <div class="main-content">
                <div class="error-container">
               </div>
            <form id="TeamInvite" method="POST" action="{% url 'teamsavedata' %}">
                {% csrf_token %}
                <input type="hidden" name="teamtypeobj" value="{{ teamtypeobj }}">
                <input type="hidden" id="strparticipantid" name="strnameparticipantid" value="{{ encoded_pid }}">
                            
                <div class="row mb-3 bg-light py-2">
                    <div class="col"><strong>Name</strong></div>
                    <div class="col"><strong>Email</strong></div>
                    <div class="col"><strong>Contact</strong></div>
                    <div class="col"><strong>Location</strong></div>
                    <div class="col"><strong>Team Type</strong></div>
                    <div class="col"><strong>Country</strong></div>
                    <div class="col"><strong>State</strong></div>
                </div>
                <div class="container">
                    {% for i in iterations %}
                        <div id="invite_form_{{ i }}" class="row mb-3" data-index="{{ i }}">
                            {% include 'Team/_invite_form.html' with index=i %}
                        </div>
                    {% endfor %}
                </div>
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-custom">Save and Next</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    
        // Existing AJAX functionality
        $('select[name=intnamecountry]').change(function() {
            var country_id = $(this).val();
            var country_name = $(this).find('option:selected').data('name');
            var index = $(this).attr('id').split('_')[1];
    
            $('#country_name_' + index).val(country_name);
    
            $.ajax({
                url: '{% url "load_states" %}',
                type: 'POST',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'country_id': country_id
                },
                success: function(data) {
                    var options = '<option value="" disabled selected>Select a State</option>';
                    data.forEach(function(state) {
                        options += '<option value="' + state.id + '" data-name="' + state.statename + '">' + state.statename + '</option>';
                    });
                    $('#intstate_' + index).html(options);
                    $('#intstate_' + index).change();
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        });
    
        
   
    
</script>

{% endblock %}
